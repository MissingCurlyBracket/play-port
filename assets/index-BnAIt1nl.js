import{S as x,s as f,h as m,g as j,n as p,u as v,r as o,a as g,b as y,j as s,L as N,R as S}from"./index-2IoCEQ3j.js";var _=class extends x{#t;#r=void 0;#e;#s;constructor(e,t){super(),this.#t=e,this.setOptions(t),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const t=this.options;this.options=this.#t.defaultMutationOptions(e),f(this.options,t)||this.#t.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#e,observer:this}),t?.mutationKey&&this.options.mutationKey&&m(t.mutationKey)!==m(this.options.mutationKey)?this.reset():this.#e?.state.status==="pending"&&this.#e.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#e?.removeObserver(this)}onMutationUpdate(e){this.#i(),this.#a(e)}getCurrentResult(){return this.#r}reset(){this.#e?.removeObserver(this),this.#e=void 0,this.#i(),this.#a()}mutate(e,t){return this.#s=t,this.#e?.removeObserver(this),this.#e=this.#t.getMutationCache().build(this.#t,this.options),this.#e.addObserver(this),this.#e.execute(e)}#i(){const e=this.#e?.state??j();this.#r={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){p.batch(()=>{if(this.#s&&this.hasListeners()){const t=this.#r.variables,a=this.#r.context;e?.type==="success"?(this.#s.onSuccess?.(e.data,t,a),this.#s.onSettled?.(e.data,null,t,a)):e?.type==="error"&&(this.#s.onError?.(e.error,t,a),this.#s.onSettled?.(void 0,e.error,t,a))}this.listeners.forEach(t=>{t(this.#r)})})}};function w(e,t){const a=v(),[r]=o.useState(()=>new _(a,e));o.useEffect(()=>{r.setOptions(e)},[r,e]);const i=o.useSyncExternalStore(o.useCallback(l=>r.subscribe(p.batchCalls(l)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),h=o.useCallback((l,c)=>{r.mutate(l,c).catch(g)},[r]);if(i.error&&y(r.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:h,mutateAsync:i.mutate}}function M({title:e}){return s.jsx("li",{className:"title-card",children:s.jsxs("div",{className:"title-card-content",children:[s.jsx(N,{to:"/title/$id",params:{id:e.id.toString()},children:e.name}),s.jsxs("div",{className:"title-details",children:[s.jsx("span",{className:"title-type",children:e.type}),s.jsxs("span",{className:"title-year",children:["(",e.year,")"]})]}),s.jsxs("div",{className:"title-ids",children:[e.imdb_id&&s.jsx("a",{href:`https://www.imdb.com/title/${e.imdb_id}`,target:"_blank",rel:"noopener noreferrer",className:"external-link",children:"IMDb"}),s.jsx("br",{}),e.tmdb_id&&s.jsx("a",{href:`https://www.themoviedb.org/${e.tmdb_type}/${e.tmdb_id}`,target:"_blank",rel:"noopener noreferrer",className:"external-link",children:"TMDB"})]})]})})}function C({person:e}){return s.jsx("li",{className:"person-card",children:s.jsxs("div",{className:"person-card-content",children:[s.jsx("h3",{className:"person-name",children:e.name}),e.main_profession&&s.jsx("div",{className:"person-profession",children:e.main_profession}),s.jsxs("div",{className:"person-ids",children:[e.imdb_id&&s.jsx("a",{href:`https://www.imdb.com/name/${e.imdb_id}`,target:"_blank",rel:"noopener noreferrer",className:"external-link",children:"IMDb"}),e.tmdb_id&&s.jsx("a",{href:`https://www.themoviedb.org/person/${e.tmdb_id}`,target:"_blank",rel:"noopener noreferrer",className:"external-link",children:"TMDB"})]})]})})}function O({searchFn:e}){const[t,a]=o.useState(""),[r,i]=o.useState(null),[h,l]=o.useState(!1),[c,d]=o.useState(null),b=async n=>{if(n.preventDefault(),t.trim()){l(!0),d(null);try{const u=await e(t.trim());i(u)}catch(u){d(u instanceof Error?u.message:"An error occurred")}finally{l(!1)}}};return s.jsxs("div",{className:"main-page",children:[s.jsx("h1",{children:"Search Movies & TV Shows"}),s.jsxs("form",{onSubmit:b,className:"search-form",children:[s.jsx("input",{type:"text",value:t,onChange:n=>a(n.target.value),placeholder:"Enter movie or TV show title...",className:"search-input"}),s.jsx("button",{type:"submit",className:"search-button",disabled:h,children:h?"Searching...":"Search"})]}),c&&s.jsxs("div",{className:"error-message",children:["Error: ",c]}),r&&s.jsxs("div",{className:"search-results",children:[r.title_results.length>0&&s.jsxs("section",{className:"titles-section",children:[s.jsxs("h2",{children:["Titles (",r.title_results.length,")"]}),s.jsx("ul",{className:"results-list",children:r.title_results.map(n=>s.jsx(M,{title:n},n.id))})]}),r.people_results.length>0&&s.jsxs("section",{className:"people-section",children:[s.jsxs("h2",{children:["People (",r.people_results.length,")"]}),s.jsx("ul",{className:"results-list",children:r.people_results.map(n=>s.jsx(C,{person:n},n.id))})]}),r.title_results.length===0&&r.people_results.length===0&&s.jsxs("div",{className:"no-results",children:['No results found for "',t,'"']})]})]})}const k=function(){const{searchApi:t}=S.useRouteContext(),a=w({mutationKey:["search"],mutationFn:async i=>await t.getByName(i)}),r=async i=>await a.mutateAsync(i);return s.jsx(O,{searchFn:r})};export{k as component};
